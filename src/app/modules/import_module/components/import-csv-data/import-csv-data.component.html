<ng-container *transloco="let t">
    <c-modal
        #modal='cModal'
        [keyboard]="true"
        id="importCsvDataModal"
        size="xl">
        <c-modal-header *ngIf="importer">
            <h5 cModalTitle>
                <fa-stack class="me-1">
                    <fa-icon [icon]="['fas', 'file-csv']"
                             stackItemSize="2x" pull="left" class="text-info"></fa-icon>
                    <fa-icon [icon]="['fas', 'plus-circle']" class="text-success"
                             stackItemSize="1x" pull="right" transform="right-5 down-15"
                    ></fa-icon>
                </fa-stack>
                <span *ngIf="importer.data_source==='csv_with_header'">
                    {{ t('Import CSV File with header') }}
                </span>
                <span *ngIf="importer.data_source==='csv_without_header'">
                    {{ t('Import CSV File without header') }}
                </span>
            </h5>
            <button (click)="hideModal()" cButtonClose></button>
        </c-modal-header>
        <c-modal-body>

            <c-row class="fieldset-legend-border-bottom">
                <c-col>
                    <fieldset>
                        <legend>
                            <h5>
                                {{ t('Overview importer configuration') }}
                                <span *ngIf="importer">
                                    <a *oitcPermission="['ImportModule','Importers', 'edit']"
                                       [routerLink]="['/', 'import_module', 'importers', 'edit', importer.id]">
                                        {{ importer.name }}
                                    </a>
                                    <span *oitcPermission="['ImportModule','Importers', 'edit']; negate: true">
                                        {{ importer.name }}
                                    </span>
                                </span>
                                <span *ngIf="importer" class="float-end">
                                    <a *oitcPermission="['ImportModule','Importers', 'edit']"
                                       class="btn btn-outline-primary btn-sm ripple"
                                       [routerLink]="['/', 'import_module', 'importers', 'edit', importer.id]">
                                        {{ t('Go to "Importer configuration"') }}
                                    </a>
                                </span>
                            </h5>
                            <hr class="border-bottom border-info border-dashed">
                        </legend>
                    </fieldset>
                </c-col>
            </c-row>
            <c-row>
                <!-- Dropzone -->
                <c-row class="mb-3">
                    <c-col [xs]="12" class="text-info py-2">
                        <fa-icon [icon]="['fas', 'info-circle']"></fa-icon>
                        {{ t('Max allowed file size: ') }}
                        {{ maxUploadLimit?.string }}
                    </c-col>
                    <c-col [xs]="12">
                        <div id="csvImportDropzone" class="dropzone dropzoneStyle">
                            <div class="dz-message">
                                <fa-icon [icon]="['fas', 'cloud-upload-alt']" size="5x"
                                         class="mb-3 text-muted"></fa-icon>
                                <br>
                                <span class="text-uppercase"> {{ t('Drop CSV file here or click to upload.') }} </span>
                            </div>
                        </div>
                    </c-col>
                </c-row>
                <!-- Dropzone end -->
            </c-row>
            <ng-container *ngIf="previewData && previewData.headers">
                <c-row class="mt-3">
                    <h4>
                        {{ t('CSV Data preview') }}
                    </h4>
                    <figure *ngIf="csvErrors && csvErrors.notValidRawData" class="text-danger">
                        <blockquote class="blockquote" *ngIf="csvErrors.notValidRawData.error">
                            <p>
                                <fa-icon [icon]="['fas', 'exclamation-triangle']"></fa-icon>
                                {{ csvErrors.notValidRawData.error }}
                            </p>
                        </blockquote>
                        <figcaption class="blockquote-footer" *ngIf="csvErrors.notValidRawData.description">
                            {{ csvErrors.notValidRawData.description }}
                        </figcaption>
                    </figure>


                </c-row>
            </ng-container>
        </c-modal-body>
        <c-modal-footer>
            <button cButton class="ripple" color="primary"
                    [disabled]="showSynchronizingSpinner || showSpinner || errors !== null"
                    (click)="startDataImport()">
                <fa-icon [icon]="['fas', 'spinner']" animation="spin" *ngIf="showSpinner"></fa-icon>
                {{ t('Start data import') }}
            </button>
            <button (click)="hideModal()" cButton class="ripple" color="default">
                {{ t('Close') }}
            </button>
        </c-modal-footer>
    </c-modal>
</ng-container>
