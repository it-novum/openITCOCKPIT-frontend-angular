<ng-container *transloco="let t">
    <ng-container *ngIf="changelogentry">
        <time class="cbp_tmtime" [dateTime]="changelogentry.time">
            <span>{{ changelogentry.time }}</span>
            <span>{{ changelogentry.timeAgoInWords }}</span>
        </time>
        <div class="cbp_tmicon txt-color-white {{changelogentry.color}}" title="{{changelogentry.action}}">
            <fa-icon [icon]="changelogentry.faIcon" class="text-light"></fa-icon>
        </div>
        <div class="cbp_tmlabel">
            <h2 class="font-md">
                {{ changelogentry.model }}
                <strong>
                    <!-- @todo: fix links -->
                    <a href="{{changelogentry.ngState}}({id: changelogentry.object_id})"
                       *ngIf="changelogentry.ngState && changelogentry.recordExists">
                        {{ changelogentry.name }}
                    </a>
                    <span *ngIf="!changelogentry.ngState || !changelogentry.recordExists"
                          [ngClass]="{'changelog_delete': (changelogentry.action ==='delete' ||
                  (changelogentry.ngState && !changelogentry.recordExists))}">
                        {{ changelogentry.name }}
                    </span>

                </strong>
                <span class="font-xs" *ngIf="changelogentry.includeUser && changelogentry.user">
                    {{ t('by') }}

                    <!-- @todo: fix links -->
                    <a *oitcPermission="['users', 'edit']" href="UsersEdit({id: changelogentry.user.id})">
                        {{ changelogentry.user.firstname }}
                        {{ changelogentry.user.lastname }}
                    </a>
                    <span *oitcPermission="['users', 'edit']; negate: true">
                        {{ changelogentry.user.firstname }}
                        {{ changelogentry.user.lastname }}
                    </span>
                </span>
                <span class="font-xs" *ngIf="changelogentry.includeUser && changelogentry.user === null">
                    {{ t('by Cronjob') }}
                </span>
            </h2>

            <!-- Add and copy changes -->
            <blockquote
                [ngClass]="{'changelog-blockquote-success': changelogentry.action ==='add', 'changelog-blockquote-primary': changelogentry.action ==='copy'}"
                *ngIf="(changelogentry.action === 'add' || changelogentry.action === 'copy')"
                class="blockquote">
                ADD !!!
            </blockquote>
            <!-- Edit changes -->
            <blockquote class="changelog-blockquote-warning blockquote" *ngIf="changelogentry.action === 'edit'">
                EDIT !!!
                <div class="ms-2" *ngIf="data">
                    <div *ngFor="let change of data">
                        <span *ngIf="change[1].isArray">
                            <span *ngFor="let field of change[1].data">
                                <footer>
                                    {{ field[0] }}:
                                    <span class="down">{{ field[1].old }}</span>
                                    <i class="fa fa-caret-right"></i>
                                    <span class="up">{{ field[1].new }}</span>
                                </footer>
                            </span>
                            IS ARRAY
                        </span>
                        <span *ngIf="!change[1].isArray">
                            IS NOT ARRAY
                        </span>


                        {{ change|json }}
                        <br/>
                        <br/>
                        {{ change[0] }}

                        <br/>
                        <br/>Change 1:
                        {{ change[1].isArray }}


                    </div>
                </div>
            </blockquote>
        </div>
    </ng-container>
</ng-container>
