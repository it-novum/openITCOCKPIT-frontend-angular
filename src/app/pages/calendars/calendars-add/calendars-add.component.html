<oitc-coreui>
    <ng-container *transloco="let t">
        <nav aria-label="breadcrumb" class="mt-3">
            <ol class="breadcrumb">
                <li class="breadcrumb-item">
                    <a [routerLink]="['/']">
                        <fa-icon [icon]="['fas', 'home']"></fa-icon>
                        {{ t('Home') }}
                    </a></li>
                <li class="breadcrumb-item">
                    <a *oitcPermission="['calendars', 'index']" [routerLink]="['/', 'calendars', 'index']">
                        <fa-icon [icon]="['fas', 'calendar']"></fa-icon>
                        {{ t('Calendars') }}
                    </a>
                </li>
                <li aria-current="page" class="breadcrumb-item active">
                    <fa-icon [icon]="['fas', 'plus']"></fa-icon>
                    {{ t('Add') }}
                </li>
            </ol>
        </nav>
        <form cForm (ngSubmit)="submit()">
            <c-card class="mb-3">
                <c-card-header>
                    <h5 cCardTitle>{{ t('Create new calendar') }}</h5>
                    <c-nav class="card-toolbar card-header-pills">
                        <c-nav-item class="px-1">
                            <button [fallbackUrl]="['calendars', 'index']" cButton class="ripple" color="default"
                                    oitcBackButton
                                    size="xs">
                                <fa-icon [icon]="['fas', 'left-long']"></fa-icon>
                                {{ t('Back') }}
                            </button>
                        </c-nav-item>
                    </c-nav>
                </c-card-header>
                <c-card-body>
                    <div class="mb-3">
                        <label cLabel>
                            {{ t('Container') }}
                            <oitc-required-icon></oitc-required-icon>
                        </label>

                        <ng-select [items]="containers"
                                   bindLabel="value"
                                   bindValue="key"
                                   name="container_id"
                                   placeholder=" {{ t('Please select a container.') }}"
                                   [virtualScroll]="true"
                                   [(ngModel)]="post.container_id">
                            <ng-template ng-option-tmp let-container="item" let-search="searchTerm">
                                <div [ngOptionHighlight]="search">
                                    {{ container.value }}
                                </div>
                            </ng-template>
                        </ng-select>
                        <oitc-form-feedback [errors]="errors" errorField="container_id"></oitc-form-feedback>
                        <div [hidden]="post.container_id > 0" class="text-warning-glow pt-1">
                            {{ t('Please select a container.') }}
                        </div>
                    </div>
                    <div class="mb-3">
                        <label cLabel for="calendarName">
                            {{ t('Name') }}
                            <oitc-required-icon></oitc-required-icon>
                        </label>
                        <input cFormControl id="calendarName" required type="text"
                               name="name"
                               oitcFormError [errors]="errors" errorField="name"
                               [(ngModel)]="post.name">
                        <oitc-form-feedback [errors]="errors" errorField="name"></oitc-form-feedback>
                    </div>
                    <div class="mb-3">
                        <label cLabel for="calendarDescription">
                            {{ t('Description') }}
                        </label>
                        <input cFormControl id="calendarDescription" required type="text"
                               name="name"
                               oitcFormError [errors]="errors" errorField="description"
                               [(ngModel)]="post.description">
                        <oitc-form-feedback [errors]="errors" errorField="description"></oitc-form-feedback>
                    </div>

                    <div class="mb-3">
                        <c-row>
                            <c-col xs="12">
                                <c-dropdown class="d-inline">
                                    <button cButton cDropdownToggle color="primary">
                                        {{ t('Add holiday') }}
                                        <span class="fi" [ngClass]="'fi-'+countryCode"></span>
                                    </button>
                                    <ul cDropdownMenu>
                                        <li *ngFor="let c of countries | keyvalue">
                                            <a cDropdownItem (click)="changeCountryCodeAndLoadHolidays(c.key)">
                                                <span class="fi" [ngClass]="'fi-'+c.key"></span>
                                                {{ c.value }}
                                            </a>
                                        </li>
                                    </ul>
                                </c-dropdown>

                                <button cButton class="ms-1 ripple" color="danger"
                                        (click)="deleteAllHolidays()">
                                    {{ t('Delete ALL holidays') }}
                                </button>

                                <button cButton class="ms-1 ripple" color="danger"
                                        (click)="deleteAllMonthEvents()">
                                    {{ t('Delete MONTH events') }}
                                </button>

                                <button cButton class="ms-1 ripple" color="danger"
                                        (click)="deleteAllEvents()">
                                    {{ t('Delete ALL events') }}
                                </button>

                            </c-col>
                        </c-row>
                    </div>

                    <div class="mb-3" *ngIf="eventsLoaded">
                        <full-calendar #fullCalendar [options]="calendarOptions()">

                            <!-- dayCellContent  Content Injection -->
                            <!-- https://fullcalendar.io/docs/day-cell-render-hooks -->
                            <ng-template #dayCellContent let-arg>
                                <div class="fc-daygrid-day-number">
                                    {{ arg.dayNumberText }}
                                </div>
                                <button cButton
                                        (click)="triggerAddEventModal(arg)"
                                        *ngIf="!hasEvents(formatJsDateToFullcalendarString(arg.date))"
                                        class="ripple" size="xs"
                                        color="success">
                                    <fa-icon [icon]="['fas', 'plus']"></fa-icon>
                                </button>
                            </ng-template>

                            <!-- eventContent Content Injection -->
                            <!-- https://fullcalendar.io/docs/event-render-hooks-->
                            <ng-template #eventContent let-arg>
                                <div class="fc-event-title-container">
                                    <div class="fc-event-title fc-sticky">
                                        <!-- Just for reference in case we cant to add some icons in the future -->
                                        <!--
                                        <fa-icon [icon]="['fas', 'calendar']"></fa-icon>
                                        -->
                                        {{ arg.event.title }}
                                    </div>
                                </div>
                            </ng-template>

                        </full-calendar>
                    </div>
                </c-card-body>
                <c-card-footer class="text-end">
                    <button cButton class="ripple" color="primary" type="submit">
                        {{ t('Create calendar') }}
                    </button>
                    <button [fallbackUrl]="['calendars', 'index']" cButton class="ms-1 ripple" color="default"
                            oitcBackButton
                            type="button">
                        {{ t('Cancel') }}
                    </button>
                </c-card-footer>
            </c-card>
        </form>


        <!-- Add new holiday modal -->
        <c-modal #addNewHolidayModal fullscreen="md" size="lg" id="addNewHolidayModal">
            <form cForm (ngSubmit)="addNewHoliday()">
                <c-modal-header>
                    <h5 cModalTitle>
                        <fa-icon [icon]="['fas', 'pen-to-square']"></fa-icon>
                        {{ t('Add new bank holiday') }}
                    </h5>
                    <button [cModalToggle]="addNewHolidayModal.id" cButtonClose></button>
                </c-modal-header>
                <c-modal-body>

                    <div class="mb-3">
                        <label cLabel for="addHolidayName">
                            {{ t('Holiday name') }}
                            <oitc-required-icon></oitc-required-icon>
                        </label>
                        <c-input-group>
                            <span cInputGroupText>
                                <fa-icon [icon]="['fas', 'pencil']"></fa-icon>
                            </span>
                            <input id="addHolidayName" cFormControl type="text"
                                   name="addHolidayName"
                                   [placeholder]="'Title' | transloco"
                                   [(ngModel)]="addNewEvent.title"/>
                        </c-input-group>

                    </div>

                </c-modal-body>
                <c-modal-footer>
                    <button cButton color="primary" type="submit" class="ripple">
                        {{ t('Save') }}
                    </button>
                    <button [cModalToggle]="addNewHolidayModal.id" cButton color="default" class="ripple">
                        {{ t('Close') }}
                    </button>
                </c-modal-footer>
            </form>
        </c-modal>

        <!-- Edit holiday modal -->
        <c-modal #editHolidayModal fullscreen="md" size="lg" id="editHolidayModal">
            <form cForm (ngSubmit)="updateHoliday()">
                <c-modal-header>
                    <h5 cModalTitle>
                        <fa-icon [icon]="['fas', 'pen-to-square']"></fa-icon>
                        {{ t('Edit holiday') }}
                    </h5>
                    <button [cModalToggle]="editHolidayModal.id" cButtonClose></button>
                </c-modal-header>
                <c-modal-body>

                    <div class="mb-3">
                        <label cLabel for="editHolidayName">
                            {{ t('Holiday name') }}
                            <oitc-required-icon></oitc-required-icon>
                        </label>
                        <c-input-group>
                            <span cInputGroupText>
                                <fa-icon [icon]="['fas', 'pencil']"></fa-icon>
                            </span>
                            <input id="editHolidayName" cFormControl type="text"
                                   name="editHolidayName"
                                   [placeholder]="'Title' | transloco"
                                   [(ngModel)]="addNewEvent.title"/>
                        </c-input-group>

                    </div>

                </c-modal-body>
                <c-modal-footer>
                    <button cButton color="danger" type="button" class="ripple me-auto"
                            (click)="deleteEvent(addNewEvent.start, true)" [cModalToggle]="editHolidayModal.id">
                        {{ t('Delete') }}
                    </button>

                    <button cButton color="primary" type="submit" class="ripple">
                        {{ t('Save') }}
                    </button>
                    <button [cModalToggle]="editHolidayModal.id" cButton color="default" class="ripple">
                        {{ t('Close') }}
                    </button>
                </c-modal-footer>
            </form>
        </c-modal>

    </ng-container>
</oitc-coreui>
