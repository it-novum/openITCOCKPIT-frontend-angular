<oitc-coreui>
    <ng-container *transloco="let t">

        <nav aria-label="breadcrumb" class="mt-3">
            <ol class="breadcrumb">
                <li class="breadcrumb-item">
                    <a [routerLink]="['/']">
                        <fa-icon [icon]="['fas', 'home']"></fa-icon>
                        {{ t('Home') }}
                    </a></li>
                <li class="breadcrumb-item">
                    <a *oitcPermission="['users', 'index']" [routerLink]="['/', 'users', 'index']">
                        <fa-icon [icon]="['fas', 'user']"></fa-icon>
                        {{ t('Users') }}
                    </a>
                </li>
                <li aria-current="page" class="breadcrumb-item active">
                    <fa-icon [icon]="['fas', 'plus']"></fa-icon>
                    {{ t('Add local') }}
                </li>
            </ol>
        </nav>


        <c-card class="mb-3">
            <c-card-header>
                <h5 cCardTitle>
                    {{ t('Create new local user') }}
                </h5>

                <c-nav class="card-toolbar card-header-pills">
                    <c-nav-item class="px-1">
                        <button [fallbackUrl]="['users', 'index']" cButton class="ripple" color="default"
                                oitcBackButton
                                size="xs">
                            <fa-icon [icon]="['fas', 'left-long']"></fa-icon>
                            {{ t('Back') }}
                        </button>
                    </c-nav-item>
                </c-nav>
            </c-card-header>


            <c-card-body>
                <div class="mb-3">
                    <label cLabel for="post.User.usercontainerroles._ids">
                        {{ t('Container Roles') }}
                        <oitc-required-icon/>
                    </label>
                    <oitc-multi-select
                            name="post.User.usercontainerroles._ids"
                            id="post.User.usercontainerroles._ids"
                            optionValue="key"
                            optionLabel="value"
                            [(ngModel)]="post.User.usercontainerroles._ids"
                            [searchCallback]="loadContainerRoles"
                            (onChange)="onContainerSelectChange($event)"
                            [options]="containerRoles.usercontainerroles"
                            oitcFormError [errors]="errors" errorField="containerroles">
                    </oitc-multi-select>
                    <oitc-form-feedback [errors]="errors" errorField="containerroles"></oitc-form-feedback>
                    <div class="help-block">
                        {{ t('Container Roles are handy to grant the same permissions to multiple users.') }}
                    </div>
                </div>

                <ng-container *ngIf="containerPermissions">
                    <c-row *ngFor="let userContainerRole of containerPermissions.userContainerRoleContainerPermissions | keyvalue"
                           class="containerRoleInheritance mb-3">
                        <c-col md="1">
                        </c-col>
                        <c-col md="11">
                            <legend class="txt-ack">
                                {{ userContainerRole.value.path }}
                                <fa-icon [icon]="['fas', 'minus-square']" class="text-danger"
                                         *ngIf="selectedContainerIds.indexOf(userContainerRole.value._joinData.container_id) !== -1"/>
                            </legend>
                            <c-row>
                                <c-col md="1">
                                </c-col>
                                <c-col md="1">
                                    <c-form-check [class]="{'strike' : selectedContainerIds.indexOf(userContainerRole.value._joinData.container_id) !== -1}">
                                        <input cFormCheckInput
                                               disabled
                                               type="radio"
                                               [name]="userContainerRole.value.id + 'PermissionLevel'"
                                               [id]="userContainerRole.value.id + 'PermissionLevelRead'"
                                               [value]="1"
                                               [(ngModel)]="userContainerRole.value._joinData.permission_level"
                                        />
                                        <label cFormCheckLabel
                                               [for]="userContainerRole.value.id + 'PermissionLevelRead'">
                                            {{ t('read') }}
                                        </label>
                                    </c-form-check>
                                </c-col>
                                <c-col md="1">
                                    <c-form-check [class]="{'strike' : selectedContainerIds.indexOf(userContainerRole.value._joinData.container_id) !== -1}">
                                        <input cFormCheckInput
                                               disabled
                                               type="radio"
                                               [name]="userContainerRole.value.id + 'PermissionLevel'"
                                               [id]="userContainerRole.value.id + 'PermissionLevelReadWrite'"
                                               [value]="2"
                                               [(ngModel)]="userContainerRole.value._joinData.permission_level"
                                        />
                                        <label cFormCheckLabel
                                               [for]="userContainerRole.value.id + 'PermissionLevelReadWrite'">
                                            {{ t('read/write') }}
                                        </label>
                                    </c-form-check>
                                </c-col>
                                <c-col md="9">
                                    <c-badge color="info">
                                        TEST
                                    </c-badge>
                                    <ng-container
                                            *ngFor="let userRole of userContainerRole.value.user_roles | keyvalue">
                                        <c-button *oitcPermission="['usercontainerroles', 'edit']"
                                                 [routerLink]="['/', 'usercontainerroles', 'edit', userRole.value.id]"
                                                  cButton size="xs" color="primary" variant="outline">
                                            {{ userRole.value.name }}
                                        </c-button>
                                        <c-button *oitcPermission="['usercontainerroles', 'edit'];negate:true"
                                                 [routerLink]="['/', 'usercontainerroles', 'edit', userRole.value.id]"
                                                 cButton size="xs" color="primary" variant="outline">
                                            {{ userRole.value.name }}
                                        </c-button>
                                    </ng-container>
                                </c-col>
                            </c-row>
                        </c-col>
                    </c-row>
                    <div class="col col-md-4 text-right div-bottom-arrow font-xs text-primary italic"
                         ng-show="post.User.usercontainerroles._ids.length > 0 && selectedUserContainers.length > 0">
                        {{ t('The user permissions will be extended or adapted with additional containers') }}
                    </div>
                </ng-container>
                <!--
                Containerrole shit (READ / READ&WRITE) ETC
                 -->


                <div class="mb-3">
                    <label cLabel for="selectedContainerIds">
                        {{ t('Container') }}
                        <oitc-required-icon/>
                    </label>
                    <oitc-multi-select
                            name="selectedContainerIds"
                            id="selectedContainerIds"
                            optionValue="key"
                            optionLabel="value"
                            [(ngModel)]="selectedContainerIds"
                            [options]="containers"
                            (onChange)="ngOnChanges()"
                            oitcFormError [errors]="errors" errorField="containers">
                    </oitc-multi-select>
                    <oitc-form-feedback [errors]="errors" errorField="containers"></oitc-form-feedback>
                    <div class="help-block text-info">
                        <fa-icon [icon]="['fas', 'info-circle']"/>
                        {{ t('Container assignments defined in the user will overwrite permissions inherited from Container Roles!') }}
                    </div>
                </div>
                <!--
                each selectedContainerIds will have a dropdown for the user to select the role
                -->

                <!-- USER ROLE DROPDOWN -->
                <div class="mb-3">
                    <label cLabel for="post.User.usergroup_id">
                        {{ t('User role') }}
                        <oitc-required-icon/>
                    </label>
                    <oitc-select
                            name="post.User.usergroup_id"
                            id="post.User.usergroup_id"
                            optionValue="key"
                            optionLabel="value"
                            [(ngModel)]="post.User.usergroup_id"
                            [options]="containers"
                            oitcFormError [errors]="errors" errorField="usergroup_id">
                    </oitc-select>
                    <oitc-form-feedback [errors]="errors" errorField="usergroup_id"></oitc-form-feedback>
                </div>

                <!-- IS ACTIVE -->
                <div class="mb-3">
                    <c-form-check>
                        <input cFormCheckInput
                               name="post.User.is_active"
                               id="post.User.is_active"
                               type="checkbox"
                               trueFalseValue
                               [(ngModel)]="post.User.is_active"
                               oitcFormError [errors]="errors" errorField="is_active"/>
                        <oitc-form-feedback [errors]="errors" errorField="is_active"></oitc-form-feedback>
                        <label cFormCheckLabel for="post.User.is_active">
                            {{ t('Is active') }}
                        </label>
                    </c-form-check>
                </div>

                <!-- EMAIL ADDRESS -->
                <div class="mb-3">
                    <label cLabel for="post.User.email" class="hintmark">
                        {{ t('Email address') }}
                    </label>
                    <input cFormControl
                           required
                           id="post.User.email"
                           type="text"
                           name="post.User.email"
                           [(ngModel)]="post.User.email"
                           oitcFormError [errors]="errors" errorField="email">
                    <oitc-form-feedback [errors]="errors" errorField="email"></oitc-form-feedback>
                </div>

                <!-- ENABLE LOGIN OAUTH2 -->
                <div class="mb-3">
                    <c-form-check>
                        <input cFormCheckInput
                               name="post.User.is_oauth"
                               id="post.User.is_oauth"
                               type="checkbox"
                               trueFalseValue
                               [(ngModel)]="post.User.is_oauth"
                               oitcFormError [errors]="errors" errorField="is_oauth"/>
                        <oitc-form-feedback [errors]="errors" errorField="is_oauth"></oitc-form-feedback>
                        <label cFormCheckLabel for="post.User.is_oauth">
                            {{ t('Enable login through oAuth2') }}
                        </label>
                    </c-form-check>
                </div>

                <!-- FIRST NAME -->
                <div class="mb-3">
                    <label cLabel for="post.User.firstname" class="hintmark">
                        {{ t('First name') }}
                    </label>
                    <input cFormControl
                           required
                           id="post.User.firstname"
                           type="text"
                           name="post.User.firstname"
                           [(ngModel)]="post.User.firstname"
                           oitcFormError [errors]="errors" errorField="firstname">
                    <oitc-form-feedback [errors]="errors" errorField="firstname"></oitc-form-feedback>
                </div>

                <!-- LAST NAME -->
                <div class="mb-3">
                    <label cLabel for="post.User.lastname" class="hintmark">
                        {{ t('Last name') }}
                    </label>
                    <input cFormControl
                           required
                           id="post.User.lastname"
                           type="text"
                           name="post.User.lastname"
                           [(ngModel)]="post.User.lastname"
                           oitcFormError [errors]="errors" errorField="lastname">
                    <oitc-form-feedback [errors]="errors" errorField="lastname"></oitc-form-feedback>
                </div>

                <!-- COMPANY -->
                <div class="mb-3">
                    <label cLabel for="post.User.company" class="hintmark">
                        {{ t('Company') }}
                    </label>
                    <input cFormControl
                           required
                           id="post.User.company"
                           type="text"
                           name="post.User.company"
                           [(ngModel)]="post.User.company"
                           oitcFormError [errors]="errors" errorField="company">
                    <oitc-form-feedback [errors]="errors" errorField="company"></oitc-form-feedback>
                </div>

                <!-- COMPANY POSITION -->
                <div class="mb-3">
                    <label cLabel for="post.User.position" class="hintmark">
                        {{ t('Company position') }}
                    </label>
                    <input cFormControl
                           required
                           id="post.User.position"
                           type="text"
                           name="post.User.position"
                           [(ngModel)]="post.User.position"
                           oitcFormError [errors]="errors" errorField="position">
                    <oitc-form-feedback [errors]="errors" errorField="position"></oitc-form-feedback>
                </div>

                <!-- PHONE NUMBER -->
                <div class="mb-3">
                    <label cLabel for="post.User.phone" class="hintmark">
                        {{ t('Phone Number') }}
                    </label>
                    <input cFormControl
                           required
                           id="post.User.phone"
                           type="text"
                           name="post.User.phone"
                           [(ngModel)]="post.User.phone"
                           oitcFormError [errors]="errors" errorField="phone">
                    <oitc-form-feedback [errors]="errors" errorField="phone"></oitc-form-feedback>
                </div>

                <!-- LENGTH OF LISTS -->
                <div class="mb-3">
                    <label cLabel for="post.User.paginatorlength" class="hintmark">
                        {{ t('Length of lists') }}
                    </label>
                    <input cFormControl
                           required
                           id="post.User.paginatorlength"
                           type="number"
                           name="post.User.paginatorlength"
                           [(ngModel)]="post.User.paginatorlength"
                           oitcFormError [errors]="errors" errorField="paginatorlength">
                    <oitc-form-feedback [errors]="errors" errorField="paginatorlength"></oitc-form-feedback>
                </div>

                <!-- SHOW STATUS BADGES IN MENU -->
                <div class="mb-3">
                    <c-form-check>
                        <input cFormCheckInput
                               name="post.User.showstatsinmenu"
                               id="post.User.showstatsinmenu"
                               type="checkbox"
                               trueFalseValue
                               [(ngModel)]="post.User.showstatsinmenu"
                               oitcFormError [errors]="errors" errorField="showstatsinmenu"/>
                        <oitc-form-feedback [errors]="errors" errorField="showstatsinmenu"></oitc-form-feedback>
                        <label cFormCheckLabel for="post.User.showstatsinmenu">
                            {{ t('Show status badges in menu') }}
                        </label>
                    </c-form-check>
                </div>

                <!-- RECURSIVE BROWSER -->
                <div class="mb-3">
                    <c-form-check>
                        <input cFormCheckInput
                               name="post.User.recursive_browser"
                               id="post.User.recursive_browser"
                               type="checkbox"
                               trueFalseValue
                               [(ngModel)]="post.User.recursive_browser"
                               oitcFormError [errors]="errors" errorField="recursive_browser"/>
                        <oitc-form-feedback [errors]="errors" errorField="recursive_browser"></oitc-form-feedback>
                        <label cFormCheckLabel for="post.User.recursive_browser">
                            {{ t('Recursive Browser') }}
                        </label>
                    </c-form-check>
                </div>

                <!-- TAB ROTATION INTERVAL SLIDER -->


                <!-- DATE FORMAT -->
                <div class="mb-3">
                    <label cLabel for="post.User.dateformat">
                        {{ t('Date format') }}
                        <oitc-required-icon/>
                    </label>
                    <oitc-select
                            name="post.User.dateformat"
                            id="post.User.dateformat"
                            optionValue="key"
                            optionLabel="value"
                            [(ngModel)]="post.User.dateformat"
                            [options]="dateformats"
                            oitcFormError [errors]="errors" errorField="dateformat">
                    </oitc-select>
                    <oitc-form-feedback [errors]="errors" errorField="dateformat"></oitc-form-feedback>
                </div>

                <!-- Time zone -->
                <div class="mb-3">
                    <label cLabel for="post.User.timezone">
                        {{ t('Timezone') }}
                        <oitc-required-icon/>
                    </label>
                    <oitc-select
                            name="post.User.timezone"
                            id="post.User.timezone"
                            optionValue="key"
                            optionLabel="value"
                            [(ngModel)]="post.User.timezone"
                            [options]="timezones"
                            oitcFormError [errors]="errors" errorField="timezone">
                    </oitc-select>
                    <oitc-form-feedback [errors]="errors" errorField="timezone"></oitc-form-feedback>
                    <div class="help-block">
                        Server timezone is: Europe/Berlin Current server time: 21.08.2024 15:52:39
                    </div>
                </div>

                <!-- frontend language -->
                <div class="mb-3">
                    <label cLabel for="post.User.i18n">
                        {{ t('Frontend language') }}
                        <oitc-required-icon/>
                    </label>
                    <oitc-select
                            name="post.User.i18n"
                            id="post.User.i18n"
                            optionValue="key"
                            optionLabel="value"
                            [(ngModel)]="post.User.i18n"
                            [options]="localeOptions"
                            oitcFormError [errors]="errors" errorField="i18n">
                    </oitc-select>
                    <oitc-form-feedback [errors]="errors" errorField="i18n"></oitc-form-feedback>
                    <div class="help-block">
                        {{ t('Manual logout and login again required for changes to take effect for the current user.') }}
                        {{ t('These options are community translations. Feel free to extend them and open a github pull request.') }}
                    </div>
                </div>

                <!-- New password -->
                <div class="mb-3">
                    <label cLabel for="post.User.password" class="hintmark">
                        {{ t('New password') }}
                    </label>
                    <input cFormControl
                           required
                           id="post.User.password"
                           type="password"
                           name="post.User.password"
                           [(ngModel)]="post.User.password"
                           oitcFormError [errors]="errors" errorField="password">
                    <oitc-form-feedback [errors]="errors" errorField="password"></oitc-form-feedback>
                    <div class="help-block">
                        {{ t('The password must consist of 6 alphanumeric characters and must contain at least one ^^   digit') }}
                    </div>
                </div>
                <!-- confirm new password -->
                <div class="mb-3">
                    <label cLabel for="post.User.confirm_password" class="hintmark">
                        {{ t('New password') }}
                    </label>
                    <input cFormControl
                           required
                           id="post.User.confirm_password"
                           type="password"
                           name="post.User.confirm_password"
                           [(ngModel)]="post.User.confirm_password"
                           oitcFormError [errors]="errors" errorField="confirm_password">
                    <oitc-form-feedback [errors]="errors" errorField="confirm_password"></oitc-form-feedback>
                </div>

                <!-- API KEYS -->
            </c-card-body>

            <c-card-footer class="text-end">
                <label class="me-2">
                    <input cFormCheckInput type="checkbox" name="createAnother"
                           [(ngModel)]="createAnother">
                    {{ t('Create another') }}
                </label>

                <button cButton class="ripple" color="primary" type="submit">
                    {{ t('Create user') }}
                </button>
                <button [fallbackUrl]="['users', 'index']" cButton class="ms-1 ripple" color="default"
                        oitcBackButton
                        type="button">
                    {{ t('Cancel') }}
                </button>


            </c-card-footer>

        </c-card>
        <p>users-add works!</p>
    </ng-container>
</oitc-coreui>

